<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Alchemy - Level Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.8;
            font-size: 1.1em;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #e9ecef;
            border: none;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        
        .tab:hover {
            background: #f8f9fa;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #495057;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .emoji-input {
            font-size: 24px !important;
            text-align: center;
            width: 80px !important;
            display: inline-block;
            margin-right: 10px;
        }
        
        .input-group {
            display: flex;
            gap: 15px;
            align-items: end;
        }
        
        .input-group .form-group {
            flex: 1;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .level-preview {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .level-preview h3 {
            color: #495057;
            margin-bottom: 15px;
        }
        
        .emoji-display {
            font-size: 48px;
            margin: 10px;
        }
        
        .plus-sign {
            font-size: 36px;
            color: #667eea;
            margin: 0 20px;
        }
        
        .equals-sign {
            font-size: 36px;
            color: #28a745;
            margin: 0 20px;
        }
        
        .levels-list {
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
        }
        
        .level-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 10px;
        }
        
        .level-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .level-info {
            flex: 1;
        }
        
        .level-actions {
            display: flex;
            gap: 10px;
        }
        
        .json-output {
            background: #1e1e1e;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            opacity: 0.9;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #99d3ff;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Emoji Alchemy Level Editor</h1>
            <p>Create and manage game levels with ease</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('single')">‚ûï Single Level</button>
            <button class="tab" onclick="switchTab('bulk')">üìã Bulk Import</button>
            <button class="tab" onclick="switchTab('manage')">‚öôÔ∏è Manage Levels</button>
            <button class="tab" onclick="switchTab('export')">üì§ Export</button>
        </div>
        
        <!-- Single Level Editor -->
        <div id="single" class="tab-content active">
            <h2>Create New Level</h2>
            
            <div class="form-group">
                <label>Level Number</label>
                <input type="number" id="levelNumber" placeholder="Enter level number" min="1">
            </div>
            
            <div class="input-group">
                <div class="form-group">
                    <label>Input Emoji 1</label>
                    <input type="text" id="input1" class="emoji-input" placeholder="üî•" maxlength="2">
                </div>
                <div class="form-group">
                    <label>Input Emoji 2</label>
                    <input type="text" id="input2" class="emoji-input" placeholder="üíß">
                </div>
                <div class="form-group">
                    <label>Input Emoji 3 (Optional)</label>
                    <input type="text" id="input3" class="emoji-input" placeholder="üå¨Ô∏è">
                </div>
            </div>
            
            <div class="form-group">
                <label>Result Emoji</label>
                <input type="text" id="result" class="emoji-input" placeholder="üí®" style="width: 100px;">
            </div>
            
            <div class="input-group">
                <div class="form-group">
                    <label>Input 1 Name</label>
                    <input type="text" id="name1" placeholder="fire">
                </div>
                <div class="form-group">
                    <label>Input 2 Name</label>
                    <input type="text" id="name2" placeholder="water">
                </div>
                <div class="form-group">
                    <label>Input 3 Name (Optional)</label>
                    <input type="text" id="name3" placeholder="wind">
                </div>
            </div>
            
            <div class="form-group">
                <label>Result Name</label>
                <input type="text" id="resultName" placeholder="steam">
            </div>
            
            <div class="level-preview" id="levelPreview">
                <h3>Level Preview</h3>
                <div id="previewContent">Enter emojis to see preview</div>
            </div>
            
            <button class="btn btn-primary" onclick="addLevel()">‚ûï Add Level</button>
            <button class="btn btn-secondary" onclick="clearForm()">üóëÔ∏è Clear Form</button>
        </div>
        
        <!-- Bulk Import -->
        <div id="bulk" class="tab-content">
            <h2>Bulk Import Levels</h2>
            <p>Paste your JSON data or upload a file to import multiple levels at once.</p>
            
            <div class="form-group">
                <label>JSON Data</label>
                <textarea id="bulkJson" rows="15" placeholder='[
  {
    "level": 1,
    "inputs": ["üî•", "üíß"],
    "result": "üí®",
    "names": {"a": "fire", "b": "water", "result": "steam"}
  },
  {
    "level": 2,
    "inputs": ["üåû", "üåßÔ∏è"],
    "result": "üåà",
    "names": {"a": "sun", "b": "rain cloud", "result": "rainbow"}
  }
]'></textarea>
            </div>
            
            <div class="input-group">
                <button class="btn btn-success" onclick="importBulkLevels()">üì• Import Levels</button>
                <button class="btn btn-secondary" onclick="validateJson()">‚úÖ Validate JSON</button>
                <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="loadFile()">
                <button class="btn btn-secondary" onclick="document.getElementById('fileInput').click()">üìÅ Load File</button>
            </div>
            
            <!-- Quick Actions after import -->
            <div class="input-group" style="margin-top: 15px; display: none;" id="quickActions">
                <div class="form-group" style="margin-bottom: 10px;">
                    <label>Pack Name</label>
                    <input type="text" id="quickExportName" placeholder="my-levels" value="">
                </div>
                <button class="btn btn-primary" onclick="quickSaveToCloud()" style="background: #00ad9f;">‚òÅÔ∏è Save to Cloud</button>
                <button class="btn btn-secondary" onclick="quickDownload()">üíæ Download</button>
                <button class="btn btn-warning" onclick="hideQuickActions()">‚úï Cancel</button>
            </div>
            
            <div id="bulkStatus"></div>
        </div>
        
        <!-- Manage Levels -->
        <div id="manage" class="tab-content">
            <h2>Manage Levels</h2>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalLevels">0</div>
                    <div class="stat-label">Total Levels</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="twoInputLevels">0</div>
                    <div class="stat-label">2-Input Levels</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="threeInputLevels">0</div>
                    <div class="stat-label">3-Input Levels</div>
                </div>
            </div>
            
            <div class="input-group" style="margin-bottom: 20px;">
                <button class="btn btn-danger" onclick="clearAllLevels()">üóëÔ∏è Clear All Levels</button>
                <button class="btn btn-secondary" onclick="loadDefaultLevels()">üîÑ Load Default Levels</button>
                <button class="btn btn-success" onclick="refreshLevelsList()">üîÑ Refresh List</button>
            </div>
            
            <!-- Quick Save Actions -->
            <div class="input-group" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <div class="form-group" style="margin-bottom: 10px;">
                    <label>Save Current Levels</label>
                    <input type="text" id="manageSaveName" placeholder="my-levels" value="">
                </div>
                <button class="btn btn-primary" onclick="quickSaveFromManage()" style="background: #00ad9f;">‚òÅÔ∏è Save to Cloud</button>
                <button class="btn btn-secondary" onclick="quickDownloadFromManage()">üíæ Download</button>
            </div>
            
            <div class="levels-list" id="levelsList">
                <!-- Levels will be populated here -->
            </div>
        </div>
        
        <!-- Export -->
        <div id="export" class="tab-content">
            <h2>Export Levels</h2>
            
            <div class="form-group">
                <label>Export Name</label>
                <input type="text" id="exportName" placeholder="my-levels" value="">
            </div>
            
            <div class="input-group">
                <button class="btn btn-primary" onclick="exportLevels()">üì§ Export JSON</button>
                <button class="btn btn-success" onclick="downloadLevels()">üíæ Download File</button>
                <button class="btn btn-secondary" onclick="copyToClipboard()">üìã Copy to Clipboard</button>
            </div>
            
            <div class="input-group" style="margin-top: 15px;">
                <button class="btn btn-primary" onclick="saveToNetlify()" style="background: #00ad9f;">‚òÅÔ∏è Save to Cloud</button>
                <button class="btn btn-secondary" onclick="loadFromNetlify()">üì• Load from Cloud</button>
            </div>
            
            <div id="exportStatus"></div>
            
            <div class="json-output" id="jsonOutput">
                Export levels to see JSON data here...
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentLevels = [];
        
        // Initialize with default levels
        window.onload = function() {
            loadDefaultLevels();
            updatePreview();
            updateStats();
            
            // Set default export name with timestamp
            const now = new Date();
            const timestamp = now.toISOString().slice(0, 19).replace(/[:-]/g, '');
            document.getElementById('exportName').value = `levels-${timestamp}`;
        };
        
        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Refresh data when switching to manage tab
            if (tabName === 'manage') {
                refreshLevelsList();
                updateStats();
            }
        }
        
        // Update level preview
        function updatePreview() {
            const input1 = document.getElementById('input1').value;
            const input2 = document.getElementById('input2').value;
            const input3 = document.getElementById('input3').value;
            const result = document.getElementById('result').value;
            
            const previewContent = document.getElementById('previewContent');
            
            if (input1 && input2 && result) {
                let preview = `<span class="emoji-display">${input1}</span>`;
                preview += `<span class="plus-sign">+</span>`;
                preview += `<span class="emoji-display">${input2}</span>`;
                
                if (input3) {
                    preview += `<span class="plus-sign">+</span>`;
                    preview += `<span class="emoji-display">${input3}</span>`;
                }
                
                preview += `<span class="equals-sign">=</span>`;
                preview += `<span class="emoji-display">${result}</span>`;
                
                previewContent.innerHTML = preview;
            } else {
                previewContent.innerHTML = 'Enter emojis to see preview';
            }
        }
        
        // Add event listeners for real-time preview
        ['input1', 'input2', 'input3', 'result'].forEach(id => {
            document.getElementById(id).addEventListener('input', updatePreview);
        });
        
        // Add single level
        function addLevel() {
            const levelNumber = parseInt(document.getElementById('levelNumber').value);
            const input1 = document.getElementById('input1').value.trim();
            const input2 = document.getElementById('input2').value.trim();
            const input3 = document.getElementById('input3').value.trim();
            const result = document.getElementById('result').value.trim();
            const name1 = document.getElementById('name1').value.trim();
            const name2 = document.getElementById('name2').value.trim();
            const name3 = document.getElementById('name3').value.trim();
            const resultName = document.getElementById('resultName').value.trim();
            
            // Validation
            if (!levelNumber || !input1 || !input2 || !result || !name1 || !name2 || !resultName) {
                showAlert('Please fill in all required fields!', 'error');
                return;
            }
            
            // Check if level number already exists
            if (currentLevels.find(level => level.level === levelNumber)) {
                showAlert(`Level ${levelNumber} already exists!`, 'error');
                return;
            }
            
            // Create level object
            const inputs = input3 ? [input1, input2, input3] : [input1, input2];
            const names = input3 ? 
                { a: name1, b: name2, c: name3, result: resultName } :
                { a: name1, b: name2, result: resultName };
            
            const newLevel = {
                level: levelNumber,
                inputs: inputs,
                result: result,
                names: names
            };
            
            // Add to levels array
            currentLevels.push(newLevel);
            currentLevels.sort((a, b) => a.level - b.level);
            
            showAlert(`Level ${levelNumber} added successfully!`, 'success');
            clearForm();
            updateStats();
        }
        
        // Clear form
        function clearForm() {
            ['levelNumber', 'input1', 'input2', 'input3', 'result', 'name1', 'name2', 'name3', 'resultName'].forEach(id => {
                document.getElementById(id).value = '';
            });
            updatePreview();
        }
        
        // Import bulk levels
        function importBulkLevels() {
            const jsonData = document.getElementById('bulkJson').value.trim();
            
            if (!jsonData) {
                showAlert('Please enter JSON data!', 'error', 'bulkStatus');
                return;
            }
            
            try {
                const levels = JSON.parse(jsonData);
                
                if (!Array.isArray(levels)) {
                    throw new Error('JSON must be an array of levels');
                }
                
                // Validate each level
                levels.forEach((level, index) => {
                    if (!level.level || !level.inputs || !level.result || !level.names) {
                        throw new Error(`Invalid level structure at index ${index}`);
                    }
                });
                
                // Add levels (replace existing ones with same level number)
                levels.forEach(newLevel => {
                    const existingIndex = currentLevels.findIndex(level => level.level === newLevel.level);
                    if (existingIndex !== -1) {
                        currentLevels[existingIndex] = newLevel;
                    } else {
                        currentLevels.push(newLevel);
                    }
                });
                
                currentLevels.sort((a, b) => a.level - b.level);
                
                showAlert(`‚úÖ Successfully imported ${levels.length} levels! Use quick actions below to save.`, 'success', 'bulkStatus');
                updateStats();
                
                // Show quick actions and set default name
                showQuickActions();
                const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '');
                document.getElementById('quickExportName').value = `imported-levels-${timestamp}`;
                
            } catch (error) {
                showAlert(`JSON Error: ${error.message}`, 'error', 'bulkStatus');
            }
        }
        
        // Validate JSON
        function validateJson() {
            const jsonData = document.getElementById('bulkJson').value.trim();
            
            if (!jsonData) {
                showAlert('Please enter JSON data to validate!', 'error', 'bulkStatus');
                return;
            }
            
            try {
                const levels = JSON.parse(jsonData);
                showAlert('JSON is valid! ‚úÖ', 'success', 'bulkStatus');
            } catch (error) {
                showAlert(`JSON Error: ${error.message}`, 'error', 'bulkStatus');
            }
        }
        
        // Load file
        function loadFile() {
            const file = document.getElementById('fileInput').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('bulkJson').value = e.target.result;
                    showAlert('File loaded successfully!', 'success', 'bulkStatus');
                };
                reader.readAsText(file);
            }
        }
        
        // Load default levels
        function loadDefaultLevels() {
            currentLevels = [
                {
                    level: 1,
                    inputs: ["üî•", "üíß"],
                    result: "üí®",
                    names: {a: "fire", b: "water", result: "steam"}
                },
                {
                    level: 2,
                    inputs: ["üåû", "üåßÔ∏è"],
                    result: "üåà",
                    names: {a: "sun", b: "rain cloud", result: "rainbow"}
                },
                {
                    level: 3,
                    inputs: ["‚ùÑÔ∏è", "üíß"],
                    result: "üßä",
                    names: {a: "snow", b: "water", result: "ice"}
                }
            ];
            updateStats();
        }
        
        // Clear all levels
        function clearAllLevels() {
            if (confirm('Are you sure you want to delete all levels? This cannot be undone!')) {
                currentLevels = [];
                updateStats();
                refreshLevelsList();
                showAlert('All levels cleared!', 'info');
            }
        }
        
        // Refresh levels list
        function refreshLevelsList() {
            const levelsList = document.getElementById('levelsList');
            
            if (currentLevels.length === 0) {
                levelsList.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">No levels created yet. Add some levels to see them here!</p>';
                return;
            }
            
            let html = '';
            currentLevels.forEach(level => {
                const inputsDisplay = level.inputs.join(' + ');
                html += `
                    <div class="level-item">
                        <div class="level-info">
                            <strong>Level ${level.level}:</strong> 
                            ${inputsDisplay} = ${level.result}
                            <br>
                            <small style="color: #6c757d;">
                                ${Object.values(level.names).slice(0, -1).join(' + ')} = ${level.names.result}
                            </small>
                        </div>
                        <div class="level-actions">
                            <button class="btn btn-danger" onclick="deleteLevel(${level.level})" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                        </div>
                    </div>
                `;
            });
            
            levelsList.innerHTML = html;
        }
        
        // Delete level
        function deleteLevel(levelNumber) {
            if (confirm(`Are you sure you want to delete Level ${levelNumber}?`)) {
                currentLevels = currentLevels.filter(level => level.level !== levelNumber);
                refreshLevelsList();
                updateStats();
                showAlert(`Level ${levelNumber} deleted!`, 'info');
            }
        }
        
        // Update statistics
        function updateStats() {
            const totalLevels = currentLevels.length;
            const twoInputLevels = currentLevels.filter(level => level.inputs.length === 2).length;
            const threeInputLevels = currentLevels.filter(level => level.inputs.length === 3).length;
            
            document.getElementById('totalLevels').textContent = totalLevels;
            document.getElementById('twoInputLevels').textContent = twoInputLevels;
            document.getElementById('threeInputLevels').textContent = threeInputLevels;
        }
        
        // Export levels
        function exportLevels() {
            if (currentLevels.length === 0) {
                showAlert('No levels to export!', 'error', 'exportStatus');
                return;
            }
            
            const exportName = document.getElementById('exportName').value.trim() || 'levels';
            const timestamp = new Date().toISOString();
            
            const exportData = {
                name: exportName,
                timestamp: timestamp,
                version: "1.0",
                totalLevels: currentLevels.length,
                levels: currentLevels
            };
            
            const jsonString = JSON.stringify(exportData, null, 2);
            document.getElementById('jsonOutput').textContent = jsonString;
            
            showAlert(`Exported ${currentLevels.length} levels successfully!`, 'success', 'exportStatus');
        }
        
        // Download levels as file
        function downloadLevels() {
            exportLevels(); // Generate JSON first
            
            const jsonString = document.getElementById('jsonOutput').textContent;
            const exportName = document.getElementById('exportName').value.trim() || 'levels';
            const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '');
            
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${exportName}-${timestamp}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert('File downloaded successfully!', 'success', 'exportStatus');
        }
        
        // Copy to clipboard
        function copyToClipboard() {
            const jsonString = document.getElementById('jsonOutput').textContent;
            
            if (!jsonString || jsonString.includes('Export levels to see')) {
                showAlert('Please export levels first!', 'error', 'exportStatus');
                return;
            }
            
            navigator.clipboard.writeText(jsonString).then(() => {
                showAlert('JSON copied to clipboard!', 'success', 'exportStatus');
            }).catch(() => {
                showAlert('Failed to copy to clipboard!', 'error', 'exportStatus');
            });
        }
        
        // Save to Netlify Cloud
        async function saveToNetlify() {
            if (currentLevels.length === 0) {
                showAlert('No levels to save!', 'error', 'exportStatus');
                return;
            }
            
            const exportName = document.getElementById('exportName').value.trim() || 'levels';
            const timestamp = new Date().toISOString();
            const id = timestamp.replace(/[-:.]/g, '').replace('T', '').slice(0, 14); // YYYYMMDDHHMMSS format
            
            const saveData = {
                id: id,
                name: exportName,
                timestamp: timestamp,
                version: "1.0",
                totalLevels: currentLevels.length,
                levels: currentLevels,
                filename: `${exportName}-${id}.json`
            };
            
            try {
                showAlert('Saving to cloud...', 'info', 'exportStatus');
                
                // Try different Netlify function paths
                const possiblePaths = [
                    '/.netlify/functions/save-levels',
                    '/netlify/functions/save-levels',
                    '/.netlify/functions/save-levels.js'
                ];
                
                let success = false;
                let lastError = null;
                
                for (const path of possiblePaths) {
                    try {
                        console.log('Trying path:', path);
                        const response = await fetch(path, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(saveData)
                        });
                        
                        if (response.ok) {
                            const result = await response.json();
                            
                            if (result.success) {
                                showAlert(`‚úÖ Saved to cloud successfully! ID: ${result.data.id}`, 'success', 'exportStatus');
                                
                                // Save to localStorage for game to access
                                const localData = result.fullData || saveData;
                                localStorage.setItem(`levelPack_${localData.id}`, JSON.stringify(localData));
                                console.log('Level pack saved to localStorage with key:', `levelPack_${localData.id}`);
                                
                                // Show in JSON output
                                document.getElementById('jsonOutput').textContent = JSON.stringify(localData, null, 2);
                                success = true;
                                break;
                            }
                        }
                    } catch (pathError) {
                        console.warn(`Path ${path} failed:`, pathError);
                        lastError = pathError;
                    }
                }
                
                if (!success) {
                    // Fallback to localStorage only
                    console.log('Cloud save failed, using localStorage fallback');
                    localStorage.setItem(`levelPack_${saveData.id}`, JSON.stringify(saveData));
                    
                    showAlert(`üíæ Saved locally! (Cloud unavailable) ID: ${saveData.id}`, 'warning', 'exportStatus');
                    document.getElementById('jsonOutput').textContent = JSON.stringify(saveData, null, 2);
                }
                
            } catch (error) {
                console.error('Save error:', error);
                
                // Fallback to localStorage
                try {
                    localStorage.setItem(`levelPack_${saveData.id}`, JSON.stringify(saveData));
                    showAlert(`üíæ Saved locally only! ID: ${saveData.id}`, 'warning', 'exportStatus');
                    document.getElementById('jsonOutput').textContent = JSON.stringify(saveData, null, 2);
                } catch (localError) {
                    showAlert(`‚ùå Save failed completely: ${localError.message}`, 'error', 'exportStatus');
                }
            }
        }
        
        // Load from Netlify Cloud
        async function loadFromNetlify() {
            try {
                showAlert('Loading from cloud...', 'info', 'exportStatus');
                
                // Try different Netlify function paths
                const possiblePaths = [
                    '/.netlify/functions/get-levels',
                    '/netlify/functions/get-levels'
                ];
                
                let response = null;
                for (const path of possiblePaths) {
                    try {
                        console.log('Trying GET path:', path);
                        response = await fetch(path);
                        if (response.ok) break;
                    } catch (e) {
                        console.warn(`GET path ${path} failed:`, e);
                    }
                }
                
                if (!response || !response.ok) {
                    throw new Error('All GET paths failed');
                }
                const result = await response.json();
                
                if (result.success && result.data.length > 0) {
                    // Show available saves
                    let html = '<h3>Available Saved Levels:</h3>';
                    result.data.forEach(save => {
                        html += `
                            <div style="border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 8px;">
                                <strong>${save.name}</strong> (${save.totalLevels} levels)<br>
                                <small>Saved: ${new Date(save.timestamp).toLocaleString()}</small><br>
                                <small>Preview: ${save.preview.join(', ')}</small><br>
                                <button class="btn btn-secondary" onclick="loadSpecificSave('${save.id}')" style="margin-top: 10px; padding: 5px 15px;">Load This Save</button>
                            </div>
                        `;
                    });
                    
                    document.getElementById('jsonOutput').innerHTML = html;
                    showAlert(`Found ${result.data.length} saved level sets!`, 'success', 'exportStatus');
                } else {
                    showAlert('No saved levels found in cloud.', 'info', 'exportStatus');
                }
                
            } catch (error) {
                console.error('Load error:', error);
                showAlert(`‚ùå Network error: ${error.message}`, 'error', 'exportStatus');
            }
        }
        
        // Load specific save (placeholder - would need actual implementation)
        function loadSpecificSave(saveId) {
            showAlert(`Loading save ${saveId}... (This would load the specific save in a real implementation)`, 'info', 'exportStatus');
        }
        
        // Show alert message
        function showAlert(message, type, containerId = null) {
            const alertClass = type === 'success' ? 'alert-success' : 
                             type === 'error' ? 'alert-error' : 'alert-info';
            
            const alertHtml = `<div class="alert ${alertClass}">${message}</div>`;
            
            if (containerId) {
                document.getElementById(containerId).innerHTML = alertHtml;
                setTimeout(() => {
                    document.getElementById(containerId).innerHTML = '';
                }, 5000);
            } else {
                // Show in current tab
                const activeTab = document.querySelector('.tab-content.active');
                const existingAlert = activeTab.querySelector('.alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                const alertDiv = document.createElement('div');
                alertDiv.innerHTML = alertHtml;
                activeTab.insertBefore(alertDiv.firstChild, activeTab.firstChild);
                
                setTimeout(() => {
                    const alert = activeTab.querySelector('.alert');
                    if (alert) alert.remove();
                }, 5000);
            }
        }
        
        // Quick Actions Functions
        function showQuickActions() {
            document.getElementById('quickActions').style.display = 'block';
        }
        
        function hideQuickActions() {
            document.getElementById('quickActions').style.display = 'none';
        }
        
        function quickSaveToCloud() {
            const name = document.getElementById('quickExportName').value.trim() || 'levels';
            document.getElementById('exportName').value = name;
            saveToNetlify();
            hideQuickActions();
        }
        
        function quickDownload() {
            const name = document.getElementById('quickExportName').value.trim() || 'levels';
            document.getElementById('exportName').value = name;
            downloadLevels();
            hideQuickActions();
        }
        
        function quickSaveFromManage() {
            const name = document.getElementById('manageSaveName').value.trim() || 'levels';
            document.getElementById('exportName').value = name;
            saveToNetlify();
        }
        
        function quickDownloadFromManage() {
            const name = document.getElementById('manageSaveName').value.trim() || 'levels';
            document.getElementById('exportName').value = name;
            downloadLevels();
        }
        
        // Set default names on page load
        function setDefaultNames() {
            const timestamp = new Date().toISOString().slice(0, 19).replace(/[:-]/g, '');
            document.getElementById('manageSaveName').value = `my-levels-${timestamp}`;
        }
        
        // Update the window.onload to include default names
        const originalOnLoad = window.onload;
        window.onload = function() {
            if (originalOnLoad) originalOnLoad();
            setDefaultNames();
        };
    </script>
</body>
</html>
